<main>
  <h1>Mangage members of the team</h1>

  <form id="addMemberForm" [formGroup]="form" (ngSubmit)="onFormSubmit()">
    <mat-form-field id="addMemberInp">
      <input matInput placeholder="Email" [formControl]="emailFormControl">
      <mat-error *ngIf="emailFormControl?.hasError('email') && !emailFormControl?.hasError('required')">
        Please enter a valid email address
      </mat-error>
      <mat-error *ngIf="emailFormControl.hasError('required')">
        Email is
        <strong>required</strong>
      </mat-error>
    </mat-form-field>
    <button type="submit" mat-raised-button>Add to team</button>
  </form>

  <div id="members">
    <div *ngFor="let member of (team$ | async)?.members | mapToIterable; let members" id="memberWrapper">
      <div id="profilePic">
        <img *ngIf="member.val.imgUrl" src="{{member.val.imgUrl}}">
        <mat-icon>account_circle</mat-icon>
      </div>
      <strong id="nameTxt">{{ member.val.name }}
        <span *ngIf="member.val.isAdmin" id="memberTypeTxt">Admin</span>
        <span *ngIf="member.val.isMember == 'mail'" id="memberTypeTxt">Pending</span>
      </strong>
      <mat-menu #memberOptionsMenu="matMenu">
        <button mat-menu-item *ngIf="!member.val.isAdmin" (click)="promoteAdmin(member.key)">
          <mat-icon>how_to_reg</mat-icon>
          <span>Promote to admin</span>
        </button>
        <button mat-menu-item *ngIf="member.val.isAdmin" (click)="removeAdmin(member.key)">
          <mat-icon>keyboard_arrow_down</mat-icon>
          <span>Remove admin priveliges</span>
        </button>
        <button mat-menu-item (click)="deleteMember(member.key)">
          <mat-icon>exit_to_app</mat-icon>
          <span *ngIf="member.val.isMember == 'mail'; else removeMemberTxt">Cancel invitation</span>
          <ng-template #removeMemberTxt>
            <span>Remove member</span>
          </ng-template>
        </button>
      </mat-menu>
      <button *ngIf="!(member.key == (auth.user$ | async)?.uid) && isAdmin" class="menuBtn" mat-icon-button [matMenuTriggerFor]="memberOptionsMenu"
        (click)="$event.stopPropagation()">
        <mat-icon>more_vert</mat-icon>
      </button>
    </div>
  </div>
  <br>
  <div id="deleteTeamWrapper" *ngIf="isAdmin">
    <h2 id="dangerTxt">Danger zone</h2>
    <p>This will delete the team and all of its data for you and all the members.</p>
    <button mat-raised-button (click)="deleteTeam()" id="deleteTeamBtn">Delete {{(team$ | async)?.name}} team</button>
  </div>
</main>