service cloud.firestore {
  match /databases/{database}/documents {
  

    // Users can only access their team
    // Needs to be updated when sharing link

    // -teams
    //   -{teamId}        --
    //      -members
    //        -{uid}
    //      -archived
    //        -{boardId}
    //      -boards
    //        -{boardId}  --
    //          -todo
    //          -inprogress
    //          -done

    //  match /teams/{teamId} {
    //    allow read: if isMemberOfTeam(teamId);
    //    allow write: if true; // memberOfTeam(teamId);

    //   match /boards/{boardID} {
    //    allow read: if memberOfTeam(teamId) || boardIsPublic(teamId);
    //    allow write: if memberOfTeam(teamId);

    //     match /beta {
    //       allow write: if memberOfTeam(teamId) || boardIsPublic(teamId);
    //     }
    //     match /{document=**} {
    //       allow read: if memberOfTeam(teamId) || boardIsPublic(teamId);
    //       allow write: if memberOfTeam(teamId);
    //      }
    //   }
    //   match /{document=**} {
    //    allow read: if isMemberOfTeam(teamId); // memberOfTeam(teamId);
    //    allow write: if true; // memberOfTeam(teamId);
    //   }

    //  }

      // TODO allow quit team
      // allow write: if isAdmin(teamId);
     

    match /{document=**} {
      allow read, write: if true;
    }
   
    match /feedback {
      allow write: if isSignedIn();
    }
    
    function isMemberOfTeam(teamId) {
    	return  get(/databases/$(database)/documents/teams/$(teamId)).members[request.auth.uid].isMember;
    }
    
    function isAdmin(teamId) {
    	return get(/databases/$(database)/documents/teams/$(teamId)).data.members[request.auth.uid].isAdmin;
    }
    
    function boardIsPublic(teamId) {
    	return get(/databases/$(database)/documents/teams/$(teamId)).data.isPublic;
    }
    
  	function isSignedIn() {
    	return request.auth.uid != null;
    }
    
    function existingData() {
    	return resource.data;
    }
    
    function incomingData() {
    	return request.resource.data;
    }
		
  }
}
// /teams/imtaPFFgbkn5PrLzwzis/boards/ZJNibiSJpipuBxFXUCzz
// XD6EkNokYXV3XTtW2UZys2FtcXI3





    // // only admins can change team settings
    // match /teams/{teamId} {
    // 	allow read: if memberOfTeam(teamId);
    // 	
    // }
    
    // // public if 
    // match /teams/{teamId}/boards/{boardID} {
  	// 	allow read: if memberOfTeam(teamId) || boardIsPublic();
    //   allow write: if memberOfTeam(teamId);
    // }