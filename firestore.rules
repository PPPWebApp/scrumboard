service cloud.firestore {
  match /databases/{database}/documents {
  

    // Users can only access their team
    // Needs to be updated when sharing link

    match /teams/{teamId} {
      match /boards/{boardID} {
       allow read: if memberOfTeam(teamId) || boardIsPublic(teamId);
       allow write: if memberOfTeam(teamId);

        match /beta {
          allow write: if memberOfTeam(teamId) || boardIsPublic(teamId);
        }
      }

      match /boards/{document=**} {
       allow write: if memberOfTeam(teamId);
       allow read: if memberOfTeam(teamId);
      }
      allow read: if memberOfTeam(teamId);
      // TODO allow quit team
      // allow write: if isAdmin(teamId);
      allow write: if memberOfTeam(teamId);
    }
   
    match /feedback {
      allow write: if isSignedIn();
    }
    
    function memberOfTeam(teamId) {
    	return  get(/databases/$(database)/documents/teams/$(teamId)).data.members[request.auth.uid].isMember;
    }
    
    function isAdmin(teamId) {
    	return get(/databases/$(database)/documents/teams/$(teamId)).data.members[request.auth.uid].isAdmin;
    }
    
    function boardIsPublic(teamId) {
    	return get(/databases/$(database)/documents/teams/$(teamId)).data.isPublic;
    }
    
  	function isSignedIn() {
    	return request.auth.uid != null;
    }
    
    function existingData() {
    	return resource.data;
    }
    
    function incomingData() {
    	return request.resource.data;
    }
		
  }
}
// /teams/imtaPFFgbkn5PrLzwzis/boards/ZJNibiSJpipuBxFXUCzz
// XD6EkNokYXV3XTtW2UZys2FtcXI3





    // // only admins can change team settings
    // match /teams/{teamId} {
    // 	allow read: if memberOfTeam(teamId);
    // 	
    // }
    
    // // public if 
    // match /teams/{teamId}/boards/{boardID} {
  	// 	allow read: if memberOfTeam(teamId) || boardIsPublic();
    //   allow write: if memberOfTeam(teamId);
    // }